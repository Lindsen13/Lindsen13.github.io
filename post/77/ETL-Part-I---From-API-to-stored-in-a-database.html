<!DOCTYPE html>
<html lang="en">
 

<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149203155-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-149203155-2');
    </script>
    <!-- Favicons -->

    <link href="/static/img/favicon/android-chrome-512x512.png" rel="icon">
    <link href="/static/img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

    <!-- Vendor CSS Files -->
    <link href="/static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendor/markdown-converter/styles.css" rel="stylesheet">

    <link href="/static/vendor/icofont/icofont.min.css" rel="stylesheet">
    <link href="/static/vendor/aos/aos.css" rel="stylesheet">
    <link href="/static/vendor/line-awesome/css/line-awesome.min.css" rel="stylesheet">
    <link href="/static/vendor/owl.carousel/assets/owl.carousel.min.css" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link href="/static/css/style.css" rel="stylesheet">

    <meta name="robots" content="index, follow">

    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport"> 
<title>Python Everything - ETL Part I - From API to stored in a database</title>
<meta name="description" content="ETL stands for Extract, Transform and Load. The first part explains how make an API call, process it and store it in a database for future use. - Traditionally, an ETL process consist of a process that will extract..."> 
</head>

<body>

    <!-- ======= Mobile Menu ======= -->
    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close mt-3">
                <span class="icofont-close js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div>

    <!-- ======= Header ======= -->
    <header class="site-navbar js-sticky-header site-navbar-target" role="banner">

        <div class="container">
            <div class="row align-items-center">

                <div class="col-6 col-lg-2">
                    <h1 class="mb-0 site-logo"><a href="/" class="mb-0">Python Everything</a></h1>
                </div>

                <div class="col-12 col-md-10 d-none d-lg-block">
                    <nav class="site-navigation position-relative text-right" role="navigation">

                        <ul class="site-menu main-menu js-clone-nav mr-auto d-none d-lg-block">
                            <li class="active"><a href="/" class="nav-link">Home</a></li>
                            <li><a href="/explore/1.html" class="nav-link">Explore</a></li>
                            <li><a href="/authors.html" class="nav-link">Collaborators</a></li>
                            <li><a href="/#contact" class="nav-link">Get in touch</a></li>
                        </ul>
                    </nav>
                </div>

                <div class="col-6 d-inline-block d-lg-none ml-md-0 py-3" style="position: relative; top: 3px;">

                    <a href="#" class="burger site-menu-toggle js-menu-toggle" data-toggle="collapse" data-target="#main-navbar">
                        <span></span>
                    </a>
                </div>

            </div>
        </div>

    </header>

    

<main id="main">

    <section class="hero-section inner-page">
        <div class="wave">

            <svg width="1920px" height="265px" viewBox="0 0 1920 265" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g id="Apple-TV" transform="translate(0.000000, -402.000000)" fill="#FFFFFF">
              <path d="M0,439.134243 C175.04074,464.89273 327.944386,477.771974 458.710937,477.771974 C654.860765,477.771974 870.645295,442.632362 1205.9828,410.192501 C1429.54114,388.565926 1667.54687,411.092417 1920,477.771974 L1920,667 L1017.15166,667 L0,667 L0,439.134243 Z" id="Path"></path>
            </g>
          </g>
        </svg>

        </div>

        <div class="container">
            <div class="row align-items-center">
                <div class="col-12">
                    <div class="row justify-content-center">
                        <div class="col-md-10 text-center hero-text">
                            <h1 data-aos="fade-up" data-aos-delay=""><h1>ETL Part I - From API to stored in a database</h1></h1>
                            <p class="mb-5" data-aos="fade-up" data-aos-delay="100">2020-07-23 &bullet; By <a href="#" class="text-white">Ivo</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>

    <section class="site-section mb-4">
        <div class="container">
            <div class="row">
                <div class="col-md-8 blog-content">

                    <p class="lead mb-5"><p><strong>ETL</strong> stands for <em>Extract</em>, <em>Transform</em> and <em>Load</em>. The first part explains how make an API call, process it and store it in a database for future use.</p></p>
                    <p><p>Traditionally, an ETL process consist of a process that will <em>extract</em> data from a datasource (for example, an external API or an internal database), applies <em>transformations</em> and business logic, and stores(<em>load</em>) it in the database:</p>
<p><img alt="Traditional ETL Process" src="https://python-everything.com/static/blogpost_content/traditional_etl_process.png" /></p>
<p>Personally, I thing data should be handled and stored in 3 steps: An input database, a staging database and an output database. The input database has raw data in it, where nothing has been changed from the original source. The staging database contains information which is transformed and enriched with other databases. The third and last database is the output database. This database contains information that is an aggregate, and ready to be shown visually with dashboards and reports. </p>
<p><img alt="Personal view on ETL Process" src="https://python-everything.com/static/blogpost_content/custom_interpretation_etl_process.png" /></p>
<p>Using this method, a SQL server for a small enterprise would look like this:</p>
<div class="codehilite"><pre><span></span><code><span class="err">database</span>
<span class="err">├── input</span>
<span class="err">│   ├── ExchangeRates</span>
<span class="err">│   ├── Customers</span>
<span class="err">│   ├── Dates</span>
<span class="err">│   ├── Sales</span>
<span class="err">│   └── Orders</span>
<span class="err">├── staging</span>
<span class="err">│   ├── Sales</span>
<span class="err">│   └── Orders</span>
<span class="err">└── output</span>
<span class="err">    ├── ProfitAnalysis</span>
<span class="err">    └── ChurnAnalysis</span>
</code></pre></div>


<p>The <em>input</em> database has raw information from Fixer.io, their internal CRM system, Dates generated with standardized workdays/timezones and Sales and Orders from an internal system. The <em>staging</em> database has Sales and orders which are enriched with customer information, exchange rates and where some business logic is applied. The <em>output</em> table contains analysis made, with the purpose to showcase them in a visualization software like Power BI or Tableau.</p>
<p>Let's see how this could look like in practice:</p>
<p>The <a href="https://python-everything.com/post/76/Aligning-currency-conversions-in-your-organisation-with-APIs-and-Python%21.html">previous post</a> described the first part of <em>Extract</em> element. We will focus on storing the data we have received from <a href="https://fixer.io/">fixer.io</a>.</p>
<p>Lets initiate a directory with all the files we need:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># create a directory called &#39;etl_part_1&#39;</span>
mkdir etl_part_1
<span class="c1"># Navigate into the directory</span>
<span class="nb">cd</span> etl_part_1
<span class="c1"># Create a virtual environment</span>
python3 -m venv env
<span class="c1"># Activate the virtual environment</span>
<span class="nb">source</span> env/bin/activate
<span class="c1"># Install the &#39;Requests&#39; package.</span>
pip install requests
<span class="c1"># Install the &#39;PyMySQL&#39; package.</span>
pip install pymysql
<span class="c1"># Install the &#39;SQLAlchemy&#39; package.</span>
pip install sqlalchemy
<span class="c1"># Create a python file for the script</span>
touch script.py
<span class="c1"># Create a python file for the configuration info</span>
touch config.py
<span class="c1"># Create a python file for the SQL tables</span>
touch models.py
</code></pre></div>


<p>We ended up with a script that retrieved data from Fixer.io, and processed it into a list of dictionaries. Let's wrap this into a function, so we can call it later to store into our database. We store the function in <em>script.py</em>:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="k">def</span> <span class="nf">process_exchange_rates</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">access_key</span><span class="p">):</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">?access_key=</span><span class="si">{</span><span class="n">access_key</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">currency_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;currency&#39;</span><span class="p">:</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currency_info</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span>
</code></pre></div>


<p>Keep in mind that our <em>config.py</em> file needs to be in the same directory. Furthermore, it consist of the url-endpoint for fixer.io, and the API key we received from them:</p>
<div class="codehilite"><pre><span></span><code><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://data.fixer.io/api/latest&#39;</span>
<span class="n">access_key</span> <span class="o">=</span> <span class="n">API_KEY</span>
</code></pre></div>


<p>Let's start extending this file with connection credentials to our database. I am using a MySQL database, but the method described below should work with any SQL database.</p>
<div class="codehilite"><pre><span></span><code><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://data.fixer.io/api/latest&#39;</span>
<span class="n">access_key</span> <span class="o">=</span> <span class="n">API_KEY</span>

<span class="n">db</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="s2">&quot;url_to_database&quot;</span><span class="p">,</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="s2">&quot;username_for_database&quot;</span><span class="p">,</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="s2">&quot;password_for_database&quot;</span><span class="p">,</span>
    <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="s2">&quot;database_name&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">db_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mysql+pymysql://</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">?charset=utf8&quot;</span>
</code></pre></div>


<p>As you can see, we added a dictionary called <em>db</em> and a string called <em>db_url</em>. Make sure to put the right credentials in there. If you have to be a bit more careful with storing passwords, you can set environmental variables for the information and use the following in your <em>config.py</em> file:</p>
<div class="codehilite"><pre><span></span><code><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://data.fixer.io/api/latest&#39;</span>
<span class="n">access_key</span> <span class="o">=</span> <span class="s1">&#39;776f1f748cfd5e0cb25a257529c17de8&#39;</span>

<span class="n">db</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;host&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DB_HOST&quot;</span><span class="p">,),</span>
    <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DB_USERNAME&quot;</span><span class="p">),</span>
    <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DB_PASSWORD&quot;</span><span class="p">),</span>
    <span class="s2">&quot;db&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;DB_NAME&quot;</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">db_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;mysql+pymysql://</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;db&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">?charset=utf8&quot;</span>
</code></pre></div>


<p>If you would like to apply the structure of the SQL query I described above, make sure to use <em>'/[DATABSENAME].input'</em> as name for the database. This will ensure that the table will land in our <em>input</em> part.</p>
<p>Now let's get started on creating a SQL table for the data. For this, we use the <em>models.py</em> file.</p>
<p>::python
    from sqlalchemy import *
    from sqlalchemy.ext.declarative import declarative_base</p>
<div class="codehilite"><pre><span></span><code><span class="err">Base = declarative_base()</span>
<span class="err">metadata = Base.metadata</span>
</code></pre></div>


<p>We import <em>declarative_base</em>, which is a Python class with some attributes we can leverage. To execute a query (and thus create a table), we need a function to connect to the database, and a function to create a session. Lets add the following functions to our <em>models.py</em> file:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">NullPool</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="k">def</span> <span class="nf">db_connect</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">db_url</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">NullPool</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_db_session</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">session</span>
</code></pre></div>


<p>The <em>db_connect</em> function creates a database engine, and the <em>create_db_session</em> returns a session constructed with the SQLAlchemy's <em>sessionmaker</em> function.</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">ExchangeRates</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A table with raw exhange rates retrieved from fixer.io</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;ExchangeRates&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>


<p>Having the declarative_base defined, we can create a class with it, which will represent the table we want to make. This table is getting seven columns: five for the output of the fixer.io outcome, and two to help us identifying what we are looking at. These two are an id column and a created_at column.</p>
<p>We want to add the snippets above together, and make sure it executes the function when we run the <em>models.py</em> file.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.pool</span> <span class="kn">import</span> <span class="n">NullPool</span>

<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
<span class="n">metadata</span> <span class="o">=</span> <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span>

<span class="k">def</span> <span class="nf">db_connect</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">create_engine</span><span class="p">(</span><span class="n">db_url</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="n">poolclass</span><span class="o">=</span><span class="n">NullPool</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">create_db_session</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="n">Session</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span> <span class="n">autoflush</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">Session</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">session</span>

<span class="k">class</span> <span class="nc">ExchangeRates</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A table with raw exhange rates retrieved from fixer.io</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;ExchangeRates&#39;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">server_default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Float</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">base</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">engine</span> <span class="o">=</span> <span class="n">db_connect</span><span class="p">()</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">create_db_session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
    <span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>


<p>The last <em>if statement</em> creates the engine, creates a session and executes the class we defined. The reason why we only create the table if '<strong>name</strong> == "<strong>main</strong>"', is because we would like to be able to import the <em>db_connect()</em> and the <em>create_db_session()</em> function. If we would have simply used the following snippet instead if the if-statement, Python would try to recreate the table every time we import a function of this file:</p>
<div class="codehilite"><pre><span></span><code><span class="n">engine</span> <span class="o">=</span> <span class="n">db_connect</span><span class="p">()</span>
<span class="n">session</span> <span class="o">=</span> <span class="n">create_db_session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div>


<p>Now we have a <em>config.py</em> file with all the sensitive information and a <em>models.py</em> file that creates a table for us. The next thing is to continue on our <em>script.py</em> file to ensure we gather exchange rates from fixer.io* and store it in the database. For this, we need to create a function that connect to the database. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pymysql.cursors</span>
<span class="kn">import</span> <span class="nn">pymysql</span>

<span class="k">def</span> <span class="nf">create_connection</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">),</span>
                        <span class="n">user</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">),</span>
                        <span class="n">password</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">),</span>
                        <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">),</span>
                        <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8mb4&#39;</span><span class="p">,</span>
                        <span class="n">cursorclass</span><span class="o">=</span><span class="n">pymysql</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
</code></pre></div>


<p>PyMySQL's connect() function takes the credentials defined in our <em>config.py</em> file. Next thing is to create a function that stores the data which we retrieved with <em>process_exchange_rates()</em>, defined in the beginning of this post. This function will execute the following SQL query:</p>
<div class="codehilite"><pre><span></span><code><span class="err">INSERT INTO ExchangeRates (timestamp, date, currency, value, base) VALUES (?,?,?,?,?)</span>
</code></pre></div>


<p>To create this query, we will loop over the outcome from our <em>process_exchange_rates()</em> function, and populate the above question marks in the sql query.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pymysql.cursors</span>
<span class="kn">import</span> <span class="nn">pymysql</span>

<span class="k">def</span> <span class="nf">store_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">,&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;,&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currency&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;,</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">,&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;),&#39;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;INSERT INTO ExchangeRates (timestamp, date, currency, value, base) VALUES </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>


<p>After the query is finalised (and note that the 11th line removed the last character from the query because it is a unwanted comma), the query is executed, and the connection commits it to the database. Let's put it all together in the <em>script.py</em> file.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">config</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pymysql.cursors</span>
<span class="kn">import</span> <span class="nn">pymysql</span>

<span class="k">def</span> <span class="nf">create_connection</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">),</span>
                        <span class="n">user</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">),</span>
                        <span class="n">password</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">),</span>
                        <span class="n">db</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;db&quot;</span><span class="p">),</span>
                        <span class="n">charset</span><span class="o">=</span><span class="s1">&#39;utf8mb4&#39;</span><span class="p">,</span>
                        <span class="n">cursorclass</span><span class="o">=</span><span class="n">pymysql</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">store_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">create_connection</span><span class="p">()</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">,&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;,&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;currency&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;,</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">,&quot;</span><span class="si">{</span><span class="n">row</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;base&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;),&#39;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;INSERT INTO ExchangeRates (timestamp, date, currency, value, base) VALUES </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">process_exchange_rates</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">access_key</span><span class="p">):</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">?access_key=</span><span class="si">{</span><span class="n">access_key</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">currency_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;currency&#39;</span><span class="p">:</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currency_info</span><span class="p">)</span>
        <span class="n">store_data</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Successfully stored data!&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">process_exchange_rates</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">access_key</span><span class="p">)</span>
</code></pre></div>


<p>Now we have a script that creates an SQL table and populates it with the newest exchange rates from fixer.io. This example can be run on a daily basis to fetch all exchange rates from now on. If we would like to capture historical rates as well, we need to loop over a list of dates of which we would like to retrieve exchange rates, and use these in the API call. To do so, I would define a function that creates a list of dates:</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">create_date_range</span><span class="p">():</span>
    <span class="n">date_start</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;2019-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s2">&quot;2019-12-31&quot;</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)]</span>
    <span class="k">while</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
        <span class="n">new_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">dates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dates</span>
</code></pre></div>


<p>This will generate a list with dates from 2019-01-01 to 2019-12-31. We can loop over this, and use <em>http://data.fixer.io/api/[DATE]?access_key=[API-KEY]</em> as a endpoint, instead of <em>http://data.fixer.io/api/latest?access_key=[API-KEY]</em>.</p>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">process_exchange_rates_historical</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">access_key</span><span class="p">):</span>
    <span class="n">url_dates</span> <span class="o">=</span> <span class="n">create_date_range</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">url_date</span> <span class="ow">in</span> <span class="n">url_dates</span><span class="p">:</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">url_date</span><span class="si">}</span><span class="s1">?access_key=</span><span class="si">{</span><span class="n">access_key</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;success&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rates&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">currency_info</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">&#39;currency&#39;</span><span class="p">:</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span><span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="s1">&#39;base&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;date&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">),</span>
                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">),</span>
                    <span class="p">}</span>
                    <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">currency_info</span><span class="p">)</span>
            <span class="n">store_data</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Successfully stored data for </span><span class="si">{</span><span class="n">url_date</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
</code></pre></div>


<p>The devined <em>process_exchange_rates_historical()</em> function above has the described logic implemented. I would advise to run this once, to populate your database with hostircal exchange rates. We can keep the function in our <em>script.py</em> file, we just need to make sure to not call it in our <code>if __name__ == "__main__"</code> statement.</p>
<p>In the next blog post, we will go over the <em>Transform</em>  and <em>Load</em> part of <em>ETL</em>.</p></p>
                </div>
                <div class="col-md-4 sidebar">
                    <div class="sidebar-box">
                        <h3>ETL Part I - From API to stored in a database</h3>
                        <img src="/static/img/blogposts/77.png" alt="Image" class="round-image img-fluid">
                        <p><p><strong>ETL</strong> stands for <em>Extract</em>, <em>Transform</em> and <em>Load</em>. The first part explains how make an API call, process it and store it in a database for future use.</p></p>
                    </div>
                    <div class="sidebar-box">
                        <div class="categories">
                            <h3>Latest posts</h3>
                            
                            <li><a href="/post/141/Extending-my-temperature-tracking-with-Python.html">Extending my temperature tracking with Python</a></li>
                            
                            <li><a href="/post/140/A-simple-dashboard-based-on-the-data-from-my-Arduino-project.html">A simple dashboard based on the data from my Arduino project</a></li>
                            
                            <li><a href="/post/139/Controling-Sonos-with-Python-in-just-a-couple-lines-of-code.html">Controling Sonos with Python in just a couple lines of code</a></li>
                            
                        </div>
                    </div>
                    <div class="sidebar-box">
                        <h3>Python Everything</h3>
                        <p>We at Python Everything try to provide you with your daily Python inspiration! Our post are ment to inspire you and ensure that you start coding in Python yourself.</p>
                        <p><a href="/about.html" class="btn btn-primary btn-sm">Read More</a></p>
                    </div>
                    <!--
                    <div class="sidebar-box">
                        <h3>Paragraph</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus itaque, autem necessitatibus voluptate quod mollitia delectus aut, sunt placeat nam vero culpa sapiente consectetur similique, inventore eos fugit cupiditate numquam!</p>
                    </div>
                    -->
                </div>
            </div>
        </div>
    </section>

</main>



    <!-- ======= Footer ======= -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0">
                    <h3>About Python Everything</h3>
                    <p>We're python enthousiasts, who want to ensure you are getting the same smile on you face everytime your python script runs successfully.</p>
                </div>
                <div class="col-md-7 ml-auto">
                    <div class="row site-section pt-0">
                        <div class="col-md-4 mb-4 mb-md-0">
                            <h3>Navigation</h3>
                            <ul class="list-unstyled">
                                <li><a href="/">Home</a></li>
                                <li><a href="/explore/1.html">Expore</a></li>
                                <li><a href="/#contact">Get in touch</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row justify-content-center text-center">
                <div class="col-md-7">
                    <p class="copyright">&copy; Copyright Python Everything. All Rights Reserved</p>
                    <div class="credits">
                        Designed by <a href="/">Python Everything</a>
                    </div>
                </div>
            </div>

        </div>
    </footer>

    <a href="#" class="back-to-top"><i class="icofont-simple-up"></i></a>

    <!-- Vendor JS Files -->
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <script src="/static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="/static/vendor/jquery.easing/jquery.easing.min.js"></script>
    <script src="/static/vendor/aos/aos.js"></script>
    <script src="/static/vendor/owl.carousel/owl.carousel.min.js"></script>
    <script src="/static/vendor/jquery-sticky/jquery.sticky.js"></script>

    <!-- Template Main JS File -->
    <script src="/static/js/main.js"></script>

</body>

</html>